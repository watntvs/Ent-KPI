<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>📘 داشبورد شاخص‌های معاونت مالی</title>
  <style>
    /* همان استایل قبلی بدون تغییر */
  </style>
</head>
<body>
  <div class="background-overlay">
    <img src="entehkhab-logo.png" alt="انتخاب الکترونیک">
  </div>

  <div class="content">
    <h1>📘 شاخص‌های معاونت مالی</h1>
    <div id="dashboard"></div>

    <div id="indicatorModal" class="modal">
      <div class="modal-content">
        <span class="close-button" onclick="closeModal()">✖</span>
        <div id="indicatorContent"></div>
        <button id="backButton" onclick="closeModal()">🔙 بازگشت</button>
      </div>
    </div>
  </div>

  <script>
    let icons = {};

    fetch("icons.json")
      .then(res => res.json())
      .then(data => {
        icons = data;
        loadDomains();
      });

    function loadDomains() {
      // فقط دامنه 01 را بارگذاری می‌کنیم
      fetch("domain_01.json")
        .then(res => res.json())
        .then(domain => {
          const container = document.getElementById("dashboard");
          const details = document.createElement("details");
          const summary = document.createElement("summary");

          summary.innerHTML = `<span class="domain-icon">📘</span> دامنه 01 – حسابداری مالی`;
          details.appendChild(summary);

          domain.subgroups.forEach(sub => {
            const subgroupTitle = document.createElement("div");
            subgroupTitle.className = "subgroup-title";
            subgroupTitle.textContent = sub.title;
            subgroupTitle.style.color = sub.color || "#007f00";
            details.appendChild(subgroupTitle);

            sub.categories.forEach(cat => {
              const catItem = document.createElement("li");
              catItem.textContent = cat.title;

              const itemList = document.createElement("ul");
              cat.items.forEach(item => {
                const li = document.createElement("li");
                const a = document.createElement("a");
                a.href = "#";
                a.textContent = item.title;
                a.addEventListener("click", () => showIndicator(item.id));
                li.appendChild(a);
                itemList.appendChild(li);
              });

              const catWrapper = document.createElement("ul");
              catWrapper.appendChild(catItem);
              catWrapper.appendChild(itemList);
              details.appendChild(catWrapper);
            });
          });

          container.appendChild(details);
        });
    }

    function showIndicator(indicatorId) {
      fetch(`domain_01/${indicatorId}.json`)
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById("indicatorContent");
          container.innerHTML = `
            <h2>📊 ${data.title}</h2>
            <p><strong>🔹 تعریف:</strong> ${data.definition || "توضیحی ثبت نشده است."}</p>
            <hr>
            <p><strong>📐 فرمول محاسبه:</strong></p>
            <p class="formula-box">${data.formula || "نامشخص"}</p>
            <hr>
            <p><strong>📦 اجزای ورودی:</strong></p>
            <ul>${(data.inputs || []).map(i => `<li>${i}</li>`).join("")}</ul>
            <hr>
            <p><strong>📊 واحد اندازه‌گیری:</strong> ${data.unit || "نامشخص"}</p>
            <hr>
            ${data.interpretation ? `
              <p><strong>🎯 تفسیر عدد شاخص:</strong></p>
              <table>
                <tr><th>مقدار</th><th>تفسیر</th></tr>
                ${data.interpretation.map(row => `<tr><td>${row.range}</td><td>${row.meaning}</td></tr>`).join("")}
              </table>
              <hr>
            ` : ""}
            ${data.example ? `
              <p><strong>📈 مثال عددی:</strong></p>
              <div class="example-box">
                ${Object.entries(data.example.values).map(([k,v]) => `• ${k} = ${v}<br>`).join("")}
                <br><br>${data.example.calculation}
              </div>
              <hr>
            ` : ""}
            <p><strong>📂 روش استخراج داده‌ها:</strong></p>
            <ul>${(data.source || []).map(s => `<li>${s}</li>`).join("")}</ul>
          `;
          document.getElementById("indicatorModal").style.display = "block";
        })
        .catch(error => {
          alert("❌ خطا در بارگذاری شاخص: " + indicatorId);
          console.error(error);
        });
    }

    function closeModal() {
      document.getElementById("indicatorModal").style.display = "none";
    }
  </script>
</body>
</html>
